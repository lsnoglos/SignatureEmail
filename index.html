<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <!-- Creado por: Noel Gilberto López Sosa -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firma de Correo Personalizado</title>
    <meta name="description"
        content="Crea tu firma de correo profesional fácilmente. Personaliza tus datos, elige plantillas, sube imágenes y obtén tu firma profesional fácilmente.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=PT+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: hsl(0 0% 96%);
            --foreground: hsl(145 30% 20%);
            --card: hsl(0 0% 100%);
            --card-foreground: hsl(145 30% 20%);
            --primary: hsl(145 60% 35%);
            --primary-foreground: hsl(0 0% 100%);
            --muted: hsl(0 0% 92%);
            --muted-foreground: hsl(145 20% 45%);
            --accent: hsl(0 70% 50%);
            --accent-foreground: hsl(0 0% 100%);
            --destructive: hsl(0 84.2% 60.2%);
            --destructive-foreground: hsl(0 0% 98%);
            --border: hsl(145 40% 75%);
            --input: hsl(145 40% 85%);
            --ring: hsl(145 60% 45%);
            --radius: 0.5rem;
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            border-color: var(--border);
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'PT Sans', sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            -webkit-font-smoothing: antialiased;
            line-height: 1.5;
        }

        .font-headline {
            font-family: 'Poppins', sans-serif;
        }

        .container {
            width: 100%;
            margin-left: auto;
            margin-right: auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }

        @media (min-width: 1280px) {
            .container {
                max-width: 1280px;
            }
        }

        .min-h-screen {
            min-height: 100vh;
        }

        .p-4 {
            padding: 1rem;
        }

        .p-6 {
            padding: 1.5rem;
        }

        .p-8 {
            padding: 2rem;
        }

        .mb-1 {
            margin-bottom: 0.25rem;
        }

        .mb-2 {
            margin-bottom: 0.5rem;
        }

        .mb-8 {
            margin-bottom: 2rem;
        }

        .mt-1 {
            margin-top: 0.25rem;
        }

        .mt-2 {
            margin-top: 0.5rem;
        }

        .mt-4 {
            margin-top: 1rem;
        }

        .mt-12 {
            margin-top: 3rem;
        }

        .pt-3 {
            padding-top: 0.75rem;
        }

        .pt-8 {
            padding-top: 2rem;
        }

        .space-y-2> :not([hidden])~ :not([hidden]) {
            margin-top: 0.3rem;
        }

        .space-y-3> :not([hidden])~ :not([hidden]) {
            margin-top: 0.75rem;
        }

        .space-y-4> :not([hidden])~ :not([hidden]) {
            margin-top: 1rem;
        }

        .space-y-6> :not([hidden])~ :not([hidden]) {
            margin-top: 0.7rem;
        }

        .space-x-2> :not([hidden])~ :not([hidden]) {
            margin-left: 0.5rem;
        }

        .gap-2 {
            gap: 0.5rem;
        }

        .gap-3 {
            gap: 0.75rem;
        }

        .gap-4 {
            gap: 1rem;
        }

        .gap-8 {
            gap: 2rem;
        }

        .text-center {
            text-align: center;
        }

        .text-xs {
            font-size: 0.75rem;
        }

        .text-sm {
            font-size: 0.875rem;
        }

        .text-lg {
            font-size: 1.125rem;
            justify-content: center;
        }

        .text-xl {
            font-size: 1.25rem;
        }

        .text-4xl {
            font-size: 2.25rem;
        }

        .font-bold {
            font-weight: 700;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-medium {
            font-weight: 500;
        }

        .text-primary {
            color: var(--primary);
        }

        .text-muted-foreground {
            color: var(--muted-foreground);
        }

        .bg-muted\/30 {
            background-color: rgba(234, 234, 234, 0.3);
        }

        .bg-white {
            background-color: #fff;
        }

        .max-w-xl {
            max-width: 36rem;
        }

        .mx-auto {
            margin-left: auto;
            margin-right: auto;
        }

        .inline-flex {
            display: inline-flex;
        }

        .flex {
            display: flex;
        }

        .grid {
            display: grid;
        }

        .items-center {
            align-items: center;
        }

        .items-end {
            align-items: flex-end;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-center {
            justify-content: center;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-grow {
            flex-grow: 1;
        }

        .w-full {
            width: 100%;
        }

        .h-full {
            height: 100%;
        }

        .grid-cols-1 {
            grid-template-columns: 1fr;
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .card {
            background-color: var(--card);
            color: var(--card-foreground);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        .card-header {
            padding: 1rem;
        }

        .card-content {
            padding: 0.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            white-space: nowrap;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.15s ease-in-out;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border: 1px solid transparent;
        }

        .btn-accent {
            background-color: var(--accent);
            color: var(--accent-foreground);
        }

        .btn-accent:hover {
            opacity: 0.9;
        }

        .input,
        .select,
        .textarea {
            display: flex;
            height: 2.5rem;
            width: 100%;
            border-radius: 0.375rem;
            border: 1px solid var(--input);
            background-color: var(--background);
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }

        .textarea {
            min-height: 80px;
            resize: vertical;
        }

        .label {
            font-size: 0.875rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .switch-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .switch-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        .switch input:checked+.switch-slider {
            background-color: var(--primary);
        }

        .switch input:checked+.switch-slider:before {
            transform: translateX(16px);
        }

        .separator {
            height: 1px;
            width: 100%;
            background-color: var(--border);
            margin: 1.5rem 0;
        }

        .icon {
            width: 1rem;
            height: 1rem;
            stroke-width: 2;
            vertical-align: middle;
        }

        .icon-xl {
            width: 2.5rem;
            height: 2.5rem;
            stroke: var(--primary);
        }

        .hidden {
            display: none !important;
        }

        #toaster-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 9999;
        }

        .toast {
            padding: 1rem;
            background-color: var(--foreground);
            color: var(--background);
            border-radius: var(--radius);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            opacity: 0;
            transform: translateY(20px);
            animation: toast-in 0.5s forwards;
        }

        .toast.destructive {
            background-color: var(--destructive);
            color: var(--destructive-foreground);
        }

        .toast-title {
            font-weight: 600;
        }

        @keyframes toast-in {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .image-preview {
            position: relative;
            width: 8rem;
            height: 8rem;
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            overflow: hidden;
            box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview .remove-btn {
            position: absolute;
            top: 0.25rem;
            right: 0.25rem;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 9999px;
            width: 1.5rem;
            height: 1.5rem;
            padding: 0;
        }

        .image-preview .remove-btn:hover {
            background-color: var(--destructive);
            color: var(--destructive-foreground);
        }

        footer {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            text-align: center;
            font-size: 0.875rem;
            color: var(--muted-foreground);
        }

        .main-layout-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        #preview-wrapper {
            order: 1;
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: var(--background);
            padding-top: 1rem;
            padding-bottom: 1rem;
            margin: -1rem;
            padding-left: 1rem;
            padding-right: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        #editor-wrapper {
            order: 2;
        }

        #preview-wrapper .card {
            position: relative;
        }

        #preview-wrapper .card-header,
        #instructions-wrapper {
            display: none;
        }

        #copy-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            z-index: 5;
        }

        #signature-render-area {
            transform-origin: top left;
            transition: transform 0.3s ease;
        }

        #signature-render-area.mobile-view {
            transform: scale(0.75);
            height: 150px;
            overflow: hidden;
        }

        .form-fields-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .form-field-item.full-width {
            grid-column: 1 / -1;
        }

        .input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-wrapper .input,
        .input-wrapper .textarea {
            padding-right: 2.75rem;
        }

        .style-toggle-btn {
            position: absolute;
            right: 0.25rem;
            height: 2rem;
            width: 2rem;
            padding: 0;
            background-color: transparent;
            border: none;
            color: var(--muted-foreground);
        }

        .style-toggle-btn:hover {
            color: var(--primary);
        }

        .style-toggle-btn.active {
            background-color: hsl(145 60% 35% / 0.2);
            color: var(--primary);
        }

        .form-field-item.editing {
            background-color: hsl(145 40% 85% / 0.2);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 0.75rem;
            margin: -0.75rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .image-preview-container {
            display: flex;
            justify-content: center;
        }

        @media (min-width: 800px) {
            .main-layout-container {
                flex-direction: row;
                align-items: flex-start;
            }

            #editor-wrapper {
                order: 1;
                flex: 1;
                min-width: 0;
            }

            #preview-wrapper {
                order: 2;
                flex: 1;
                min-width: 0;
                position: sticky;
                top: 2rem;
                padding: 0;
                margin: 0;
                background-color: transparent;
                box-shadow: none;
            }

            #preview-wrapper .card-header,
            #instructions-wrapper {
                display: block;
            }

            #copy-btn {
                position: static;
                width: 100%;
            }

            #signature-render-area.mobile-view {
                transform: scale(1);
                height: auto;
                min-height: 200px;
            }

            .form-fields-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body class="font-body">
    <div id="app-container" class="min-h-screen p-4 md:p-8"></div>
    <div id="toaster-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const uccDefaultLogoSquare = 'https://logosnicas.com/wp-content/uploads/2022/08/universidad_de_ciencias_comerciales_ucc.png';

            const uccDefaultBanner = 'https://ci3.googleusercontent.com/mail-sig/AIorK4x3CLDTT9xI1cX443k99vxd0LowmPr3UYy4R31QAB4IFSfu9rCmrQ-rsdLnI3ruqaz4D3D6o5M';
            
            const defaultFieldStyle = (fontSize, color = '#333333', isBold = false, isItalic = false) => ({ color, isBold, isItalic, fontSize });
            
            let signatureData = {
                fullName: 'Noel López Sosa',
                title: 'UCC Virtual',
                nombreSede: 'Campus León',
                phone: 'Cel. 58085130',
                address: 'Nicaragua',
                
                websiteUrl: '',
                cita: 'No puedo enseñar nada a nadie. Solo puedo hacerles pensar',
                
                useCustomImage: false,
                logo: uccDefaultLogoSquare,
                bannerImage: uccDefaultBanner,
                
                fontFamily: 'Tahoma, Geneva, sans-serif',
                
                fullNameStyle: defaultFieldStyle(14, '#006400', true, false),
                titleStyle: defaultFieldStyle(12, '#8B0000'),
                nombreSedeStyle: defaultFieldStyle(11, '#DAA520'),
                addressStyle: defaultFieldStyle(11),
                phoneStyle: defaultFieldStyle(11),
                websiteUrlStyle: defaultFieldStyle(11, '#0056b3'),
                citaStyle: defaultFieldStyle(11, '#555555', false, true),
                
                selectedTemplate: 'classic',
                
                logoWidth: 87,
                logoAlignment: 'right',
                logoVerticalAlignment: 'middle',
                logoPaddingTop: 0,
                logoPaddingRight: 0,
                logoPaddingBottom: 0,
                logoPaddingLeft: 0,
                
                lineaSeparadoraVisible: true,
                lineaSeparadoraColor: '#D4AC0D',
                separatorThickness: 1,
                separatorHeight: 90,
                separatorMargin: 10,
                
                bannerWidth: 400,
                bannerPadding: 10,
                bannerAlignment: 'left',
                
                containerBorderVisible: false, containerBorderThickness: 2, containerBorderRadius: 8, containerBorderGradientStart: '#D4AC0D', containerBorderGradientEnd: '#1A5276', containerBackgroundColor: '#ffffff', containerShadowVisible: false, containerShadowX: 0, containerShadowY: 4, containerShadowBlur: 10, containerShadowColor: 'rgba(0,0,0,0.1)',
                
                infoTextAlign: 'left',
                infoPaddingTop: 0,
                infoPaddingRight: 0,
                infoPaddingBottom: 0,
                infoPaddingLeft: 0,
            };

            const defaultSignatureData = JSON.parse(JSON.stringify(signatureData));
            let activeStyleEditor = null;

            const icons = {
                gem: '<svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon-xl"><path d="M6 3h12l4 6-10 13L2 9Z"/><path d="M12 22V9"/><path d="m3.29 9 8.71 13 8.71-13L12 3Z"/></svg>',
                edit: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>',
                user: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
                briefcase: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>',
                palette: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z"/></svg>', settings: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>', building: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><rect width="16" height="20" x="4" y="2" rx="2"/><path d="M9 22v-4h6v4"/><path d="M8 6h.01"/><path d="M16 6h.01"/><path d="M12 6h.01"/><path d="M12 10h.01"/><path d="M12 14h.01"/><path d="M16 10h.01"/><path d="M16 14h.01"/><path d="M8 10h.01"/><path d="M8 14h.01"/></svg>', mapPin: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>', phone: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>', link: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"/></svg>', quote: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 2v6h3v8Z"/><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.75-2-2-2h-4c-1.25 0-2 .75-2 2v6h3v8Z"/></svg>', layoutDashboard: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>', image: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>', copy: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>', type: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" x2="15" y1="20" y2="20"/><line x1="12" x2="12" y1="4" y2="20"/></svg>', gripVertical: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><circle cx="9" cy="12" r="1"/><circle cx="9" cy="5" r="1"/><circle cx="9" cy="19" r="1"/><circle cx="15" cy="12" r="1"/><circle cx="15" cy="5" r="1"/><circle cx="15" cy="19" r="1"/></svg>', appWindow: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M10 4v4"/><path d="M2 8h20"/><path d="M6 4v4"/></svg>', bold: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/><path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/></svg>', italic: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><line x1="19" x2="10" y1="4" y2="4"/><line x1="14" x2="5" y1="20" y2="20"/><line x1="15" x2="9" y1="4" y2="20"/></svg>', x: '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>',
            };
            const fieldsConfig = [{ name: 'fullName', label: 'Nombre completo', icon: icons.user }, { name: 'title', label: 'Cargo', icon: icons.briefcase }, { name: 'nombreSede', label: 'Sede', icon: icons.building }, { name: 'address', label: 'Ubicación', icon: icons.mapPin }, { name: 'phone', label: 'Teléfono', icon: icons.phone, type: 'tel' }, { name: 'websiteUrl', label: 'Sitio web / Red social', icon: icons.link, type: 'url', placeholder: 'https://...' }, { name: 'cita', label: 'Cita reflexiva (opcional)', icon: icons.quote, isTextarea: true, placeholder: 'Ej: La perseverancia es la clave del éxito.' },];
            const appContainer = document.getElementById('app-container');
            const toasterContainer = document.getElementById('toaster-container');

            function renderApp() {
                const currentYear = new Date().getFullYear();
                appContainer.innerHTML = `<header class="mb-8 text-center"><div class="inline-flex items-center gap-3 mb-2">${icons.user}<h1 class="font-headline text-4xl font-bold text-primary">Firma de Correo</h1></div><p class="text-muted-foreground max-w-xl mx-auto">Crea tu firma de correo profesional.</p></header><main class="container mx-auto"><div class="main-layout-container"><div id="preview-wrapper">${renderPreviewCard()}</div><div id="editor-wrapper"><div class="card shadow-xl h-full"><div class="card-content p-6">${renderEditorForm()}</div></div></div></div></main><footer class="mt-12 pt-8"><p>&copy; ${currentYear} Firma de Correo Personalizado. By Noel López.</p><p class="mt-1">...</p></footer>`;
                updateLayoutClasses();
            }
            function renderPreviewCard() { return ` <div class="card h-full flex flex-col"> <div class="card-header"> <h2 class="card-title font-headline text-xl">Vista Previa</h2> </div> <div class="card-content flex-grow flex flex-col gap-4"> <div id="signature-render-area"> ${generateSignatureHtml(signatureData)} </div> <div id="instructions-wrapper" class="space-y-2"> <button type="button" id="copy-btn" class="btn btn-accent">${icons.copy} Copiar Firma</button> </div> </div> </div> `; }

            function renderEditorForm() {
                return `
                <form id="signature-form" class="space-y-6">
                    ${renderTemplateSelector()}
                    <div class="separator"></div>
                    <h4 class="label font-semibold pt-3 text-lg">Datos Personales</h4><br/>
                    <div class="form-fields-grid">
                        ${fieldsConfig.map(renderFormField).join('')}
                    </div>
                    <div class="separator"></div>
                    ${renderImageControls()}
                    <div class="separator"></div>
                    ${renderGeneralStyles()}
                </form>
            `;
            }

            function renderFormField(field) {
                const styleFieldPrefix = `${field.name}Style`;
                const isEditing = activeStyleEditor === field.name;
                const fieldWrapperClass = `form-field-item ${field.isTextarea ? 'full-width' : ''} ${isEditing ? 'editing' : ''}`;
                const buttonClass = `style-toggle-btn ${isEditing ? 'active' : ''}`;

                return `
                <div class="${fieldWrapperClass}">
                    <label for="${field.name}" class="label mb-1">${field.icon} ${field.label}</label>
                    <div class="input-wrapper">
                        ${field.isTextarea ?
                        `<textarea id="${field.name}" class="textarea" data-property="${field.name}" placeholder="${field.placeholder || ''}">${signatureData[field.name] || ''}</textarea>` :
                        `<input id="${field.name}" type="${field.type || 'text'}" class="input" data-property="${field.name}" value="${signatureData[field.name] || ''}" placeholder="${field.placeholder || ''}">`
                    }
                        <button type="button" class="${buttonClass}" data-toggle-style-editor="${field.name}">${icons.edit}</button>
                    </div>
                    <div class="${isEditing ? '' : 'hidden'}">
                        ${renderFieldStyleControls(styleFieldPrefix)}
                    </div>
                </div>
            `;
            }

            function renderImageControls() {
                const showClassic = signatureData.selectedTemplate === 'classic';
                const showBanner = signatureData.selectedTemplate === 'banner';

                return `
                    <div class="flex items-center justify-between mt-4">
                        <label for="useCustomImage" class="label">${icons.image} Usar imagen personalizada (desde URL)</label>
                        <label class="switch">
                            <input type="checkbox" id="useCustomImage" data-property="useCustomImage" ${signatureData.useCustomImage ? 'checked' : ''}>
                            <span class="switch-slider"></span>
                        </label>
                    </div>
                    
                    <div class="${(signatureData.useCustomImage && showClassic) ? 'w-full space-y-2 mt-2' : 'hidden'}">
                        <label class="label text-xs mb-1">URL del Logo</label>
                        <input type="text" class="input text-xs" data-property="logo" value="${signatureData.logo !== uccDefaultLogoSquare ? signatureData.logo : ''}" placeholder="https://imgur.com/mi-logo.png">
                        ${signatureData.logo && signatureData.logo !== uccDefaultLogoSquare ? `<img src="${signatureData.logo}" class="image-preview" alt="Vista previa del logo" style="object-fit: contain;">` : ''}
                    </div>
                    
                    <div class="${(signatureData.useCustomImage && showBanner) ? 'w-full space-y-2 mt-2' : 'hidden'}">
                        <label class="label text-xs mb-1">URL del Banner</label>
                        <input type="text" class="input text-xs" data-property="bannerImage" value="${signatureData.bannerImage !== uccDefaultBanner ? signatureData.bannerImage : ''}" placeholder="https://imgur.com/mi-banner.png">
                        ${signatureData.bannerImage && signatureData.bannerImage !== uccDefaultBanner ? `<img src="${signatureData.bannerImage}" style="width:100%; height:auto; border: 1px solid var(--border); border-radius: 0.375rem;" alt="Vista previa del Banner">` : ''}
                    </div>

                    <div class="${(!signatureData.useCustomImage && showClassic) ? 'image-preview-container' : 'hidden'}">
                        <img src="${uccDefaultLogoSquare}" alt="Logo UCC por defecto" class="image-preview">
                    </div>
                    <div class="${(!signatureData.useCustomImage && showBanner) ? 'image-preview-container' : 'hidden'}">
                        <img src="${uccDefaultBanner}" alt="Banner UCC por defecto" style="width:100%; height:auto; border: 1px solid var(--border); border-radius: 0.375rem;">
                    </div>
                `;
            }

            function renderTemplateSelector() {
                let activePreset = 'custom';
                if (signatureData.selectedTemplate === 'banner') {
                    activePreset = 'banner';
                } else {
                    const isColorido = signatureData.fullNameStyle.color === '#006400';
                    if (isColorido) {
                        activePreset = 'colorido';
                    } else {
                        activePreset = 'classic';
                    }
                }
                return `
                    <div class="space-y-2">
                        <label for="selectedTemplate" class="label">${icons.layoutDashboard} Seleccionar Estilo</label>
                        <select id="selectedTemplate" class="select">
                            <option value="classic" ${activePreset === 'classic' ? 'selected' : ''}>Estilo Clásico</option>
                            <option value="banner" ${activePreset === 'banner' ? 'selected' : ''}>Estilo Banner</option>
                            <option value="colorido" ${activePreset === 'colorido' ? 'selected' : ''}>Colorido</option>
                        </select>
                    </div>
                `;
            }

            function renderImageUpload(property) { const currentImage = signatureData[property]; return ` <div class="space-y-2"> <input type="file" class="input" accept="image/*" data-image-upload-for="${property}"> ${currentImage ? ` <div class="image-preview"> <img src="${currentImage}" alt="Preview"> <button type="button" class="btn btn-icon btn-ghost remove-btn" data-remove-image-for="${property}">${icons.x}</button> </div> ` : ''} </div>`; }
            function renderFieldStyleControls(prefix) { const style = signatureData[prefix]; return ` <div class="mt-2 mb-3 p-3 border rounded-md bg-muted/30 shadow-sm"> <div class="grid grid-cols-2 md:grid-cols-4 gap-x-4 gap-y-3 items-center"> <div> <label class="label text-xs mb-1">${icons.palette} Color</label> <input type="color" class="input" value="${style.color}" data-style-property="color" data-style-prefix="${prefix}"> </div> <div> <label class="label text-xs mb-1">Tamaño (px)</label> <input type="number" class="input text-xs" value="${style.fontSize}" data-style-property="fontSize" data-style-prefix="${prefix}"> </div> <div class="flex items-center space-x-2 pt-3"> <label class="switch"> <input type="checkbox" data-style-property="isBold" data-style-prefix="${prefix}" ${style.isBold ? 'checked' : ''}> <span class="switch-slider"></span> </label> <label class="label text-xs">${icons.bold} Negrita</label> </div> <div class="flex items-center space-x-2 pt-3"> <label class="switch"> <input type="checkbox" data-style-property="isItalic" data-style-prefix="${prefix}" ${style.isItalic ? 'checked' : ''}> <span class="switch-slider"></span> </label> <label class="label text-xs">${icons.italic} Cursiva</label> </div> </div> </div>`; }


            function renderGeneralStyles() {
                const webSafeFonts = ['Arial, Helvetica, sans-serif', 'Verdana, Geneva, sans-serif', 'Tahoma, Geneva, sans-serif', 'Trebuchet MS, Helvetica, sans-serif', 'Georgia, serif', 'Times New Roman, Times, serif', 'Courier New, Courier, monospace', 'PT Sans, sans-serif', 'Poppins, sans-serif',];
                return `
                    <div class="space-y-4">
                        <div class="separator"></div>
                        <h3 class="font-headline text-lg label">${icons.palette} Personaliza Texto</h3>

                        ${renderInfoBlockStyles()}

                        <div class="separator"></div>

                        <div class="${signatureData.selectedTemplate === 'classic' ? '' : 'hidden'}">
                            ${renderClassicStyles()}
                        </div>
                        <div class="${signatureData.selectedTemplate === 'banner' ? '' : 'hidden'}">
                            ${renderBannerStyles()}
                        </div>
                        <div class="separator"></div>

                        <div class="space-y-3">
                            <h3 class="font-headline text-lg label">${icons.appWindow} Personaliza Contenedor de firma</h3>
                            <div>
                                <label class="label text-xs mb-1">Color de Fondo</label>
                                <input type="color" class="input" data-property="containerBackgroundColor" value="${signatureData.containerBackgroundColor}">
                            </div>
                            <div class="flex items-center space-x-2 pt-3">
                                <label class="switch">
                                    <input type="checkbox" data-property="containerBorderVisible" ${signatureData.containerBorderVisible ? 'checked' : ''}>
                                    <span class="switch-slider"></span>
                                </label>
                                <label class="label text-xs">Borde Visible</label>
                            </div>
                            <div class="space-y-3 p-3 border rounded-md ${signatureData.containerBorderVisible ? '' : 'hidden'}">
                                <label class="label text-xs font-semibold">Opciones de Borde con Degradado</label>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                                    <div>
                                        <label class="label text-xs mb-1">Color Inicio</label>
                                        <input type="color" class="input" data-property="containerBorderGradientStart" value="${signatureData.containerBorderGradientStart}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Color Fin</label>
                                        <input type="color" class="input" data-property="containerBorderGradientEnd" value="${signatureData.containerBorderGradientEnd}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Grosor Borde (px)</label>
                                        <input type="number" class="input text-xs" data-property="containerBorderThickness" value="${signatureData.containerBorderThickness}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Radio Borde (px)</label>
                                        <input type="number" class="input text-xs" data-property="containerBorderRadius" value="${signatureData.containerBorderRadius}">
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2 pt-3">
                                <label class="switch">
                                    <input type="checkbox" data-property="containerShadowVisible" ${signatureData.containerShadowVisible ? 'checked' : ''}>
                                    <span class="switch-slider"></span>
                                </label>
                                <label class="label text-xs">Sombra Visible</label>
                            </div>
                            <div class="space-y-3 p-3 border rounded-md ${signatureData.containerShadowVisible ? '' : 'hidden'}">
                                <label class="label text-xs font-semibold">Opciones de Sombra</label>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 items-end mt-2">
                                    <div>
                                        <label class="label text-xs mb-1">Posición X (px)</label>
                                        <input type="number" class="input text-xs" data-property="containerShadowX" value="${signatureData.containerShadowX}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Posición Y (px)</label>
                                        <input type="number" class="input text-xs" data-property="containerShadowY" value="${signatureData.containerShadowY}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Desenfoque (px)</label>
                                        <input type="number" class="input text-xs" data-property="containerShadowBlur" value="${signatureData.containerShadowBlur}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Color Sombra</label>
                                        <input type="color" class="input" data-property="containerShadowColor" value="${signatureData.containerShadowColor}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderInfoBlockStyles() {
                const webSafeFonts = ['Arial, Helvetica, sans-serif', 'Verdana, Geneva, sans-serif', 'Tahoma, Geneva, sans-serif', 'Trebuchet MS, Helvetica, sans-serif', 'Georgia, serif', 'Times New Roman, Times, serif', 'Courier New, Courier, monospace', 'PT Sans, sans-serif', 'Poppins, sans-serif'];
                return `
                    <div class="space-y-3 mt-4">
                        <div class="p-3 border rounded-md space-y-3">
                            
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label for="fontFamily" class="label text-xs mb-1">${icons.type} Fuente del texto</label>
                                    <select id="fontFamily" class="select text-xs" data-property="fontFamily">
                                        ${webSafeFonts.map(font => `<option value="${font}" ${signatureData.fontFamily === font ? 'selected' : ''}>${font.split(',')[0]}</option>`).join('')}
                                    </select>
                                </div>
                                <div>
                                    <label class="label text-xs mb-1">Alineación del Texto</label>
                                    <select class="select text-xs" data-property="infoTextAlign">
                                        <option value="left" ${signatureData.infoTextAlign === 'left' ? 'selected' : ''}>Izquierda</option>
                                        <option value="center" ${signatureData.infoTextAlign === 'center' ? 'selected' : ''}>Centro</option>
                                        <option value="right" ${signatureData.infoTextAlign === 'right' ? 'selected' : ''}>Derecha</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="label text-xs mb-1">Espacios alrededor del texto</label>
                                <div class="grid grid-cols-4 gap-2">
                                    <div>
                                        <label class="label text-xs mb-1">Superior</label>
                                        <input type="number" class="input text-xs" data-property="infoPaddingTop" value="${signatureData.infoPaddingTop}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Derecho</label>
                                        <input type="number" class="input text-xs" data-property="infoPaddingRight" value="${signatureData.infoPaddingRight}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Inferior</label>
                                        <input type="number" class="input text-xs" data-property="infoPaddingBottom" value="${signatureData.infoPaddingBottom}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Izquierdo</label>
                                        <input type="number" class="input text-xs" data-property="infoPaddingLeft" value="${signatureData.infoPaddingLeft}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderClassicStyles() {
                return `
                    <div class="mt-4 space-y-3">
                        <h3 class="font-headline text-lg label">${icons.palette} Personaliza Logo</h3>
                        <div class="p-3 border rounded-md space-y-4">

                            <div style="display: flex; align-items: flex-end; gap: 1rem;">

                                <div style="flex-grow: 1;">
                                    <label class="label text-xs mb-1">Tamaño</label>
                                    <input type="number" class="input text-xs" data-property="logoWidth" value="${signatureData.logoWidth}">
                                </div>

                                <div style="flex-grow: 1;">
                                    <label class="label text-xs mb-1">Alinear Horizontal</label>
                                    <select class="select text-xs" data-property="logoAlignment">
                                        <option value="left" ${signatureData.logoAlignment === 'left' ? 'selected' : ''}>Izquierda</option>
                                        <option value="center" ${signatureData.logoAlignment === 'center' ? 'selected' : ''}>Centro</option>
                                        <option value="right" ${signatureData.logoAlignment === 'right' ? 'selected' : ''}>Derecha</option>
                                    </select>
                                </div>

                                <div style="flex-grow: 1;">
                                    <label class="label text-xs mb-1">Alinear Vertical</label>
                                    <select class="select text-xs" data-property="logoVerticalAlignment">
                                        <option value="top" ${signatureData.logoVerticalAlignment === 'top' ? 'selected' : ''}>Arriba</option>
                                        <option value="middle" ${signatureData.logoVerticalAlignment === 'middle' ? 'selected' : ''}>Centro</option>
                                        <option value="bottom" ${signatureData.logoVerticalAlignment === 'bottom' ? 'selected' : ''}>Abajo</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="label text-xs mb-1">Espacios alrededor del logo</label>
                                <div class="grid grid-cols-4 gap-2">
                                    <div>
                                        <label class="label text-xs mb-1">Superior</label>
                                        <input type="number" class="input text-xs" data-property="logoPaddingTop" value="${signatureData.logoPaddingTop}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Derecho</label>
                                        <input type="number" class="input text-xs" data-property="logoPaddingRight" value="${signatureData.logoPaddingRight}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Inferior</label>
                                        <input type="number" class="input text-xs" data-property="logoPaddingBottom" value="${signatureData.logoPaddingBottom}">
                                    </div>
                                    <div>
                                        <label class="label text-xs mb-1">Izquierdo</label>
                                        <input type="number" class="input text-xs" data-property="logoPaddingLeft" value="${signatureData.logoPaddingLeft}">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="separator"></div>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <h3 class="font-headline text-lg label">${icons.gripVertical} Línea vertical</h3>
                            <label class="switch">
                                <input type="checkbox" data-property="lineaSeparadoraVisible" ${signatureData.lineaSeparadoraVisible ? 'checked' : ''}>
                                <span class="switch-slider"></span>
                            </label>
                        </div>
                        <div class="grid grid-cols-4 gap-4 items-end ${signatureData.lineaSeparadoraVisible ? '' : 'hidden'}">
                            <div>
                                <label class="label text-xs mb-1">Color</label>
                                <input type="color" class="input" data-property="lineaSeparadoraColor" value="${signatureData.lineaSeparadoraColor}">
                            </div>
                            <div>
                                <label class="label text-xs mb-1">Ancho</label>
                                <input type="number" class="input text-xs" data-property="separatorThickness" value="${signatureData.separatorThickness}">
                            </div>
                            <div>
                                <label class="label text-xs mb-1">Altura</label>
                                <input type="number" class="input text-xs" data-property="separatorHeight" value="${signatureData.separatorHeight}">
                            </div>
                            <div>
                                <label class="label text-xs mb-1">Espacio alrededor</label>
                                <input type="number" class="input text-xs" data-property="separatorMargin" value="${signatureData.separatorMargin}">
                            </div>
                        </div>
                    </div>
                `;
            }

            function renderBannerStyles() {
                return `
                <div class="mt-4 space-y-2">
                    <h3 class="font-headline text-lg label">${icons.image} Personaliza Banner</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="label text-xs mb-1">Tamaño (px)</label>
                            <input type="number" class="input text-xs" data-property="bannerWidth" value="${signatureData.bannerWidth}">
                        </div>
                        <div>
                            <label class="label text-xs mb-1">Espacios alrededor (px)</label>
                            <input type="number" class="input text-xs" data-property="bannerPadding" value="${signatureData.bannerPadding}">
                        </div>
                        <div>
                            <label class="label text-xs mb-1">Alineación</label>
                            <select class="select text-xs" data-property="bannerAlignment">
                                <option value="left" ${signatureData.bannerAlignment === 'left' ? 'selected' : ''}>Izquierda</option>
                                <option value="center" ${signatureData.bannerAlignment === 'center' ? 'selected' : ''}>Centro</option>
                                <option value="right" ${signatureData.bannerAlignment === 'right' ? 'selected' : ''}>Derecha</option>
                            </select>
                        </div>
                    </div>
                </div>
                `;
            }
            
            function convertGoogleDriveUrl(url) {
                if (url.includes('drive.google.com/file/d/') && !url.includes('uc?export=view')) {
                    const match = url.match(/d\/([a-zA-Z0-9_-]+)/);
                    if (match && match[1]) {
                        const fileId = match[1];
                        return `https://drive.google.com/uc?export=view&id=${fileId}`;
                    }
                }
                return url;
            }

            const generateSignatureHtml = (data) => {
                const { fullName, title, nombreSede, phone, address, websiteUrl, cita, logo: customLogo, bannerImage: customBannerImage, useCustomImage, fontFamily, selectedTemplate, lineaSeparadoraVisible, lineaSeparadoraColor, separatorThickness, separatorHeight, separatorMargin, logoWidth, logoAlignment, logoVerticalAlignment, logoPaddingTop, logoPaddingRight, logoPaddingBottom, logoPaddingLeft, fullNameStyle, titleStyle, nombreSedeStyle, phoneStyle, addressStyle, websiteUrlStyle, citaStyle, bannerWidth, bannerPadding, bannerAlignment, containerBorderVisible, containerBorderThickness, containerBorderRadius, containerBorderGradientStart, containerBorderGradientEnd, containerBackgroundColor, containerShadowVisible, containerShadowX, containerShadowY, containerShadowBlur, containerShadowColor, infoTextAlign, infoPaddingTop, infoPaddingRight, infoPaddingBottom, infoPaddingLeft } = data;
                const effectiveLogo = useCustomImage && customLogo ? customLogo : uccDefaultLogoSquare;
                const effectiveBanner = useCustomImage && customBannerImage ? customBannerImage : uccDefaultBanner;
                
                const getFieldHtml = (content, style, tag = 'div', isLink = false, href = '#') => {
                    if (!content) return '';
                    const inlineStyle = `font-weight: ${style.isBold ? 'bold' : 'normal'}; font-style: ${style.isItalic ? 'italic' : 'normal'}; font-size: ${style.fontSize}px; margin: 0; padding: 0; line-height: 1.4; color: ${style.color};`;
                    if (isLink && href) {
                        return `<${tag} style="margin: 0; padding:0;"><a href="${href}" target="_blank" rel="noopener noreferrer" style="${inlineStyle} text-decoration: none;">${content}</a></${tag}>`;
                    }
                    return `<${tag} style="${inlineStyle}">${content}</${tag}>`;
                };
                
                let tableContainerStyle = `font-family: ${fontFamily}; font-size: 12px; line-height: 1.5; border-collapse: collapse; padding: 15px; width: 100%; max-width: 550px; background-color: ${containerBackgroundColor}; border-radius: ${containerBorderRadius}px;`; if (containerBorderVisible) { tableContainerStyle += ` border: ${containerBorderThickness}px solid transparent; background-image: linear-gradient(${containerBackgroundColor}, ${containerBackgroundColor}), linear-gradient(to right, ${containerBorderGradientStart}, ${containerBorderGradientEnd}); background-origin: border-box; background-clip: content-box, border-box;`; } if (containerShadowVisible) { tableContainerStyle += ` box-shadow: ${containerShadowX}px ${containerShadowY}px ${containerShadowBlur}px ${containerShadowColor};`; } const infoContainerStyle = `text-align: ${infoTextAlign}; padding: ${infoPaddingTop}px ${infoPaddingRight}px ${infoPaddingBottom}px ${infoPaddingLeft}px;`; const cleanPhone = phone ? phone.replace(/[^0-9+]/g, '') : ''; let finalHtml = '';
                if (selectedTemplate === 'classic') {
                    const logoContainerStyle = `vertical-align: ${logoVerticalAlignment}; text-align: ${logoAlignment}; padding: ${logoPaddingTop}px ${logoPaddingRight}px ${logoPaddingBottom}px ${logoPaddingLeft}px;`;
                    const separatorHtml = lineaSeparadoraVisible ? ` <td style="vertical-align: ${logoVerticalAlignment}; padding: 0 ${separatorMargin}px;"> <div style="height: ${separatorHeight}px; width: ${separatorThickness}px; background-color: ${lineaSeparadoraColor};"></div> </td>` : '<td></td>';
                    finalHtml = ` <table style="${tableContainerStyle}" cellpadding="0" cellspacing="0" border="0"> <tbody> <tr> <td style="${logoContainerStyle}"> ${effectiveLogo ? `<img src="${effectiveLogo}" alt="Logo" width="${logoWidth}" style="width: ${logoWidth}px; height: auto; display: inline-block; border-radius: 4px;">` : ''} </td> ${separatorHtml} <td style="vertical-align: ${logoVerticalAlignment}; ${infoContainerStyle}"> ${getFieldHtml(fullName, fullNameStyle)} ${getFieldHtml(title, titleStyle)} ${getFieldHtml(nombreSede, nombreSedeStyle)} ${getFieldHtml(address, addressStyle)} ${getFieldHtml(phone, phoneStyle)} ${getFieldHtml(websiteUrl, websiteUrlStyle, 'div', true, websiteUrl)} ${getFieldHtml(cita, citaStyle)} </td> </tr> </tbody> </table>`;
                } else { 
                    finalHtml = `
                        <table style="${tableContainerStyle}" cellpadding="0" cellspacing="0" border="0">
                            <tbody>
                                <tr>
                                    <td>
                                        <div style="${infoContainerStyle} padding-bottom: 10px;">
                                            ${getFieldHtml(fullName, fullNameStyle)}
                                            ${getFieldHtml(title, titleStyle)}
                                            ${getFieldHtml(nombreSede, nombreSedeStyle)}
                                            ${getFieldHtml(address, addressStyle)}
                                            ${getFieldHtml(phone, phoneStyle)}
                                            ${getFieldHtml(websiteUrl, websiteUrlStyle, 'div', true, websiteUrl)}
                                            ${getFieldHtml(cita, citaStyle)}
                                        </div>
                                    </td>
                                </tr>
                                ${effectiveBanner ? `
                                <tr>
                                    <td style="padding-top: ${bannerPadding}px; text-align: ${bannerAlignment};">
                                        <img src="${effectiveBanner}" alt="Banner" width="${bannerWidth}" style="width: ${bannerWidth}px; max-width: 100%; height: auto; display: inline-block;">
                                    </td>
                                </tr>` : ''}
                            </tbody>
                        </table>`;
                }
                return finalHtml;
            };

            function updateAndRerender(fullRender = false) { if (fullRender) { renderApp(); return; } const formContainer = document.querySelector('#editor-wrapper .card-content'); if (formContainer) { const scrollY = formContainer.scrollTop; formContainer.innerHTML = renderEditorForm(); formContainer.scrollTop = scrollY; } const previewContainer = document.getElementById('preview-wrapper'); if (previewContainer) { previewContainer.innerHTML = renderPreviewCard(); } updateLayoutClasses(); }
            function showToast(title, description, variant = 'default') { const toast = document.createElement('div'); toast.className = `toast ${variant}`; toast.innerHTML = `<div class="toast-title">${title}</div>${description ? `<div>${description}</div>` : ''}`; toasterContainer.appendChild(toast); setTimeout(() => { toast.remove(); }, 3000); }
            async function handleCopyHtml() { const html = generateSignatureHtml(signatureData); try { const blob = new Blob([html], { type: 'text/html' }); const clipboardItem = new ClipboardItem({ 'text/html': blob }); await navigator.clipboard.write([clipboardItem]); showToast("¡Firma Copiada!", "Pégala en Gmail o Outlook para un mejor resultado."); } catch (err) { console.error("Fallo al copiar HTML enriquecido: ", err); try { await navigator.clipboard.writeText(html); showToast("Copiado como Texto Plano", "No se pudo copiar el formato enriquecido.", "destructive"); } catch (fallbackErr) { console.error("Fallo total al copiar:", fallbackErr); showToast("Fallo al Copiar", "Tu navegador no pudo acceder al portapapeles.", "destructive"); } } }
            function updateLayoutClasses() { const isMobile = window.innerWidth < 800; const renderArea = document.getElementById('signature-render-area'); if (renderArea) { if (isMobile) { renderArea.classList.add('mobile-view'); } else { renderArea.classList.remove('mobile-view'); } } }

            appContainer.addEventListener('input', e => {
                const target = e.target;
                if (target.dataset.property) {
                    const property = target.dataset.property;
                    let value = target.value; 

                    if (property === 'logo' || property === 'bannerImage') {
                        const convertedUrl = convertGoogleDriveUrl(value);
                        if (convertedUrl !== value) {
                            value = convertedUrl;
                            target.value = value;
                        }
                    }
                    signatureData[property] = target.type === 'number' ? (parseInt(value, 10) || 0) : value;
                }
                if (target.dataset.styleProperty) {
                    const property = target.dataset.styleProperty;
                    const prefix = target.dataset.stylePrefix;
                    const value = target.type === 'checkbox' ? target.checked : (target.type === 'number' ? (parseInt(target.value, 10) || 0) : target.value);
                    signatureData[prefix][property] = value;
                }
                document.getElementById('signature-render-area').innerHTML = generateSignatureHtml(signatureData);
            });

            appContainer.addEventListener('change', e => {
                const target = e.target;

                if (target.id === 'selectedTemplate') {
                    const presetName = target.value;
                    signatureData = JSON.parse(JSON.stringify(defaultSignatureData));

                    if (presetName === 'classic') {
                        signatureData.selectedTemplate = 'classic';
                        signatureData.fullNameStyle = defaultFieldStyle(18, '#000000', true, false);
                        signatureData.titleStyle = defaultFieldStyle(14, '#000000', true, false);
                        signatureData.nombreSedeStyle = defaultFieldStyle(13, '#000000');
                        signatureData.websiteUrl = '';
                        signatureData.cita = 'La creatividad es la inteligencia divirtiéndose.';
                        signatureData.fontFamily = 'Arial, Helvetica, sans-serif';
                        signatureData.infoTextAlign = 'left';
                        signatureData.infoPaddingTop = 20;
                        signatureData.infoPaddingBottom = 20;
                        signatureData.infoPaddingLeft = 15;
                        signatureData.logoWidth = 100;
                        signatureData.logoPaddingTop = 0;
                        signatureData.logoPaddingRight = 0;
                        signatureData.logoPaddingBottom = 0;
                        signatureData.logoPaddingLeft = 0;
                        signatureData.lineaSeparadoraVisible = true;
                        signatureData.separatorThickness = 4;
                        signatureData.separatorHeight = 130;
                        signatureData.containerShadowVisible = true;
                        signatureData.containerShadowX = 5;
                        signatureData.containerShadowY = 5;
                        signatureData.containerShadowBlur = 20;
                    } else if (presetName === 'banner') {
                        signatureData.selectedTemplate = 'banner';
                        signatureData.fullNameStyle = defaultFieldStyle(14, '#444444', true, false);
                        signatureData.titleStyle = defaultFieldStyle(14, '#063561', true, false);
                        signatureData.nombreSedeStyle = defaultFieldStyle(14, '#063561', true, false);
                        signatureData.phone = '';
                        signatureData.address = '';
                        signatureData.websiteUrl = '';
                        signatureData.cita = '';
                        signatureData.infoTextAlign = 'left';
                        signatureData.infoPaddingTop = 0;
                        signatureData.infoPaddingRight = 0;
                        signatureData.infoPaddingBottom = 0;
                        signatureData.infoPaddingLeft = 0;
                        signatureData.bannerWidth = 350;
                        signatureData.bannerPadding = 0;
                        signatureData.bannerAlignment = 'left';
                    } else if (presetName === 'colorido') {
                        
                        signatureData.selectedTemplate = 'classic';
                        signatureData.fullNameStyle = defaultFieldStyle(14, '#006400', true, false);
                        signatureData.titleStyle = defaultFieldStyle(12, '#8B0000');
                        signatureData.nombreSedeStyle = defaultFieldStyle(11, '#DAA520');
                        signatureData.addressStyle = defaultFieldStyle(11);
                        signatureData.phoneStyle = defaultFieldStyle(11);
                        signatureData.websiteUrlStyle = defaultFieldStyle(11);
                        signatureData.citaStyle = defaultFieldStyle(11, '#555555', false, true);

                        signatureData.fullName = 'Noel López Sosa';
                        signatureData.phone = 'Cel. 58085130',
                        signatureData.address = 'Nicaragua',
                            
                        signatureData.logoWidth = 87;
                        signatureData.logoAlignment = 'right';
                        signatureData.logoVerticalAlignment = 'middle';
                        signatureData.logoPaddingTop = 0;
                        signatureData.logoPaddingRight = 0;
                        signatureData.logoPaddingBottom = 0;
                        signatureData.logoPaddingLeft = 0;
                        signatureData.logoWidth = 87;
                        signatureData.logoWidth = 87;

                        signatureData.lineaSeparadoraVisible = true;
                        signatureData.lineaSeparadoraColor = '#D4AC0D';
                        signatureData.separatorThickness = 1;
                        signatureData.separatorHeight = 90;
                        signatureData.separatorMargin = 10;
                        signatureData.bannerWidth = 400;
                        signatureData.bannerPadding = 10;

                        signatureData.fontFamily = 'Tahoma, Geneva, sans-serif';
                        signatureData.infoPaddingTop = 0;
                        signatureData.infoPaddingRight = 0;
                        signatureData.infoPaddingBottom = 0;
                        signatureData.infoPaddingLeft = 0;
                    }
                }

                if (target.matches('input[type="checkbox"][data-property]')) {
                    const property = target.dataset.property;
                    signatureData[property] = target.checked;
                    if (property === 'useCustomImage') {
                        if (!target.checked) {
                            signatureData.logo = uccDefaultLogoSquare;
                            signatureData.bannerImage = uccDefaultBanner;
                        } else {
                            if (signatureData.logo === uccDefaultLogoSquare) signatureData.logo = '';
                            if (signatureData.bannerImage === uccDefaultBanner) signatureData.bannerImage = '';
                        }
                    }
                }
                
                updateAndRerender(true);
            });

            appContainer.addEventListener('click', e => { const button = e.target.closest('button'); if (!button) return; if (button.id === 'copy-btn') { handleCopyHtml(); } if (button.dataset.toggleStyleEditor) { const fieldName = button.dataset.toggleStyleEditor; activeStyleEditor = activeStyleEditor === fieldName ? null : fieldName; updateAndRerender(true); } if (button.dataset.removeImageFor) { const property = button.dataset.removeImageFor; signatureData[property] = null; updateAndRerender(true); } });

            let resizeTimeout;
            window.addEventListener('resize', () => { clearTimeout(resizeTimeout); resizeTimeout = setTimeout(() => renderApp(), 150); });
            renderApp();
        });
    </script>
</body>

</html>
